<h2 id="groups">Groups</h2>
<ul class="incremental">
<li><strong>Group A</strong>: Strong scaling of TPC-H query 3 (selective
joins with aggregation) with increasing threads (1, 2, 4, 8)
<ul class="incremental">
<li>keep memory and scale factor constant (e.g., 10GB memory limit,
scale factor 10)</li>
</ul></li>
<li><strong>Group B</strong>: Strong scaling of TPC-H query 13
(star-schema with non-correlated subquery) with increasing threads (1,
2, 4, 8)
<ul class="incremental">
<li>keep memory and scale factor constant (e.g., 10GB memory limit,
scale factor 10)</li>
</ul></li>
<li><strong>Group C</strong>: Weak scaling of TPC-H query 3 (selective
joins with aggregation) with increasing scale factor and threads
<ul class="incremental">
<li>keep memory constant (e.g., 10GB memory limit)</li>
</ul></li>
<li><strong>Group D</strong>: Weak scaling of TPC-H query 13
(star-schema with non-correlated subquery) with increasing scale factor
and threads
<ul class="incremental">
<li>keep memory constant (e.g., 10GB memory limit)</li>
</ul></li>
</ul>
<hr />
<h2 id="setup">Setup</h2>
<ol class="incremental" type="1">
<li><p>Install DuckDB</p></li>
<li><p>Run <code>duckdb</code> to start the DuckDB shell</p></li>
<li><p>load the TPC-H extension</p>
<pre><code>INSTALL tpch;
LOAD tpch;</code></pre></li>
<li><p>Generate the TPC-H data at scale factor 1</p>
<pre><code>CALL dbgen(sf = 1);</code></pre>
<p>The scale factor can be adjusted as needed (e.g.,
<code>sf = 10</code> for scale factor 10). Be careful with larger scale
factors as they will consume more disk space and memory.</p>
<table>
<colgroup>
<col style="width: 18%" />
<col style="width: 19%" />
<col style="width: 22%" />
<col style="width: 40%" />
</colgroup>
<thead>
<tr>
<th>Scale factor</th>
<th>Database size</th>
<th>Generation time</th>
<th>Single-step generation memory</th>
</tr>
</thead>
<tbody>
<tr>
<td>100</td>
<td>26 GB</td>
<td>17 minutes</td>
<td>71 GB</td>
</tr>
<tr>
<td>300</td>
<td>78 GB</td>
<td>51 minutes</td>
<td>211 GB</td>
</tr>
<tr>
<td>1,000</td>
<td>265 GB</td>
<td>2 h 53 minutes</td>
<td>647 GB</td>
</tr>
<tr>
<td>3,000</td>
<td>796 GB</td>
<td>8 h 30 minutes</td>
<td>1,799 GB</td>
</tr>
</tbody>
</table></li>
<li><p>Verify the data has been generated by querying a table, for
example:</p>
<pre><code>SELECT COUNT(*) FROM lineitem;</code></pre></li>
<li><p>Additional documentation at
https://duckdb.org/docs/extensions/tpch</p></li>
</ol>
<h2 id="configuration-knobs">Configuration knobs</h2>
<ul class="incremental">
<li>scale factors: (<code>CALL dbgen(sf=1)</code>): 1, 2, 3, 4, 5, 6, 7,
8, 9, 10</li>
<li>memory limits (<code>SET memory_limit = '&lt;value&gt;';</code>):
1GB, 2GB, 5GB, 10GB</li>
<li>threads (<code>SET threads = &lt;value&gt;;</code>): 1, 2, 4, 8</li>
<li>optional extras: if you adjust <code>temp_directory</code>,
<code>preserve_insertion_order</code>, or any settings from
https://duckdb.org/docs/stable/configuration/overview, record the
rationale and observed effect</li>
</ul>
<h2 id="working-with-duckdb">Working with DuckDB</h2>
<p>I recommend having a <code>setup.sql</code> file that contains all
the setup commands. The dbgen call can take awhile, so its good to
separate this into its own file and isolate it from the rest of your
queries.</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- setup.sql</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>INSTALL tpch;</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>LOAD tpch;</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="kw">CALL</span> dbgen(sf <span class="op">=</span> <span class="dv">1</span>); <span class="co">-- adjust scale factor as needed</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> memory_limit <span class="op">=</span> <span class="st">&#39;10GB&#39;</span>; <span class="co">-- adjust memory limit as needed</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> threads <span class="op">=</span> <span class="dv">4</span>; <span class="co">-- adjust number of threads as needed, if constant</span></span></code></pre></div>
<p>Then create separate files for each query you want to run, for
example <code>query3.sql</code>:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>.timer <span class="kw">on</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> threads <span class="op">=</span> <span class="dv">4</span>; <span class="co">-- adjust number of threads as needed, if not constant</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECt</span> <span class="op">..</span>.</span></code></pre></div>
<p>You can invoke DuckDB from the command line and run your setup and
query files like this:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">duckdb</span> tpch.db <span class="op">&lt;</span> setup.sql</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ex">duckdb</span> tpch.db <span class="op">&lt;</span> query3.sql <span class="co"># for one-off</span></span></code></pre></div>
<p>Or you can open the DuckDB shell and read in the files interactively
with <code>duckdb tpch.db</code></p>
<pre><code>duckdb&gt; .read query3.sql
duckdb&gt; .read query3.sql
duckdb&gt; .read query3.sql</code></pre>
